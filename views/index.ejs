<%-include("partials/header.ejs")%>
<% if(locals.window){%>
    <div class="my-1 pt-4 pb-4 text-center create-container">
        <div style="background-color: rgb(255, 255, 255 ,0.5);">
            <h1 class="display-5 mb-1 fw-bold"><% if(window==='create'){%> Create a new Blog<%}else{%> Updating <%}%></h1>
            <form id="blogForm" action="/upload" method="<%if(window==='create'){%>POST<%}else{%>PATCH<%}%>" enctype="multipart/form-data">
                <div class="input-container">
                    <label for="TitleTextbox"><span class="required-icon">*</span>Title</label>
                    <input required type="text" name="title" <% if(locals.title){%>value="<%=title%>" <%}%> id="TitleTextbox">
                    <div class="error" id="nameError">Please fill out this field.</div>
                </div> 
                <div>
                    <label for="BlogText">Text</label>
                    <textarea id="BlogText" name="text"><%if(locals.text){%><%=text%><%}%> </textarea>
                </div>
                <%if(window=="create"){%>
                    <div class="input-container">
                        <input required type="file" accept="image/*" id="imageInput" name="image">
                    </div>
                <%}%>
                <div class="col-lg-6 pb-2 mx-auto"> 
                    <div class="d-grid gap-2 d-sm-flex justify-content-sm-center"> 
                        <input class="btn btn-success" <%if(window==='create'){%>type="submit"<%}else{%>type="button" onclick="doPatch();"<%}%> value="Submit" onsubmit="return(validate())">
                    </div> 
                </div> 
            </form>
        </div>
    </div>
<%}else{%>
<div class="px-4 my-1 text-center border-bottom start-page"> 
    <div class="col-12 start-page-top"> 
        <h1 class="display-4 fw-bold">Brians Blog About Stuff</h1> 
        <img class="blog-photo" src="images/start.png">
        <h2>Blogs</h2>
    </div> 
    <div class="blog-container" style="max-height: 30vh;">
            <%if(locals.blogData){%>
                <%for(const [key,value] of Object.entries(blogData)){%>
                    <div class="container blogContainer"> 
                        <div class="row flex-lg-row-reverse align-items-right g-5"> 
                            <div class="col-10 col-sm-8 col-lg-6 align-content-center image-container">
                                <% if(value.image){%>
                                <img src="/image/<%=value.image%>" class="d-block img-fluid blog-list-image" alt="Bootstrap Themes" width="50%" height="300" loading="lazy">
                                <%}else{%>
                                <img src="images/vine.png" class="d-block img-fluid blog-list-image" alt="Bootstrap Themes" width="50%" height="300" loading="lazy">
                                <%}%>
                            </div> 
                            <div class="col-lg-6 text-align-center align-content-center"> 
                                <h2 class="fw-bold lh-1"><a href="/update?title=<%=key%>"><%=key%></a></h1> 
                                <p class="lead"><%=value.text.slice(0,100)%></p> 
                            </div> 
                        </div> 
                    </div>
                <%}%>
            <%}%>
    </div> 
</div>
<%}%>
<script>function doPatch(){
    if(blogForm.TitleTextbox.value.length==0){
        nameError.style.display = "block";
        //nameInput.classList.add("error-border");
        return;
    }
    let content = {
            title: blogForm.TitleTextbox.value,
            text: blogForm.BlogText.value
    };
        fetch("/",{
            method:'PATCH',
            headers:{
                'Content-type': 'application/json; charset=UTF-8',
                'Accept': 'application/json'
            },
            body: JSON.stringify(content)
        }).then((response) => {
            console.log('PATCH Response.status: ', response.status);
            window.location.href = "/";
        });
    }
    function validate(){
        if($('#upload')[0].files.length === 0){
        alert("You must set an image");
        $('#upload').focus();

        return false;
    }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<%-include("partials/footer.ejs")%>